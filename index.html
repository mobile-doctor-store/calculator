<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free advanced online scientific calculator with history, functions, graph visualization, and themes.">
  <meta name="keywords" content="scientific calculator, graph calculator, online calculator, math calculator, trigonometry, logarithm, algebra calculator">
  <meta name="author" content="MobileDoctor">
  <meta name="robots" content="index, follow">
  <meta name="google-adsense-account" content="ca-pub-2488763930939291">
  
  <!-- Open Graph Tags -->
  <meta property="og:title" content="Advanced Scientific Calculator with Graph Visualization">
  <meta property="og:description" content="Free advanced scientific calculator for solving complex math problems with graph visualization capabilities.">
  <meta property="og:image" content="https://calculator.mobiledoctor.org.in/images/calculator-thumbnail.jpg">
  <meta property="og:url" content="https://calculator.mobiledoctor.org.in">
  <meta property="og:type" content="website">
  
  <!-- Twitter Card Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Advanced Scientific Calculator with Graph">
  <meta name="twitter:description" content="Solve advanced math problems with graph visualization using this free online scientific calculator.">
  <meta name="twitter:image" content="https://calculator.mobiledoctor.org.in/images/calculator-thumbnail.jpg">
  <meta name="twitter:site" content="@mobiledoctor">

  <!-- Canonical Link for SEO -->
  <link rel="canonical" href="https://calculator.mobiledoctor.org.in">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§®</text></svg>">
  
  <!-- Title -->
  <title>Advanced Scientific Calculator with Graph - Free Online Math Tool</title>

  <!-- Structured Data for SEO: JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Advanced Scientific Calculator with Graph",
    "description": "An advanced online scientific calculator with graph visualization, trigonometric, logarithmic, and other advanced mathematical functions.",
    "url": "https://calculator.mobiledoctor.org.in",
    "mainEntityOfPage": "https://calculator.mobiledoctor.org.in",
    "operatingSystem": "Any",
    "applicationCategory": "EducationalApplication",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "publisher": {
      "@type": "Organization",
      "name": "MobileDoctor",
      "logo": {
        "@type": "ImageObject",
        "url": "https://calculator.mobiledoctor.org.in/logo.png"
      }
    }
  }
  </script>

  <!-- Google AdSense Code -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488763930939291"
     crossorigin="anonymous"></script>

  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #166088;
      --accent-color: #4cb5f5;
      --background-color: #f5f7fa;
      --display-bg: #f0f4f8;
      --button-bg: #ffffff;
      --button-hover: #e9eef4;
      --text-color: #333333;
      --border-color: #d1d9e6;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
      --graph-bg: #ffffff;
      --graph-axis: #cccccc;
      --graph-line: #4a6fa5;
      --ad-container-bg: #f8f9fa;
      --ad-border: #e0e0e0;
    }

    .dark-mode {
      --primary-color: #5d7cab;
      --secondary-color: #1a6fa5;
      --accent-color: #5ac8fa;
      --background-color: #1a1a2e;
      --display-bg: #16213e;
      --button-bg: #2d3748;
      --button-hover: #4a5568;
      --text-color: #e2e8f0;
      --border-color: #4a5568;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      --graph-bg: #16213e;
      --graph-axis: #4a5568;
      --graph-line: #5ac8fa;
      --ad-container-bg: #1e293b;
      --ad-border: #374151;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease, color 0.3s ease;
      line-height: 1.6;
    }

    header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      text-align: center;
      padding: 1.5rem;
      box-shadow: var(--shadow);
    }

    h1 {
      font-size: 2.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .header-description {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }

    .calculator-container {
      width: 100%;
      max-width: 500px;
      background-color: var(--button-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 2rem;
    }

    #display {
      width: 100%;
      min-height: 80px;
      padding: 1.5rem;
      font-size: 1.8rem;
      text-align: right;
      background-color: var(--display-bg);
      border: none;
      color: var(--text-color);
      outline: none;
      border-bottom: 1px solid var(--border-color);
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1px;
      background-color: var(--border-color);
    }

    button {
      border: none;
      padding: 1rem;
      font-size: 1.2rem;
      background-color: var(--button-bg);
      color: var(--text-color);
      cursor: pointer;
      transition: background-color 0.2s;
      min-height: 60px;
    }

    button:hover {
      background-color: var(--button-hover);
    }

    .operator {
      background-color: var(--primary-color);
      color: white;
    }

    .operator:hover {
      background-color: var(--secondary-color);
    }

    .equals {
      background-color: var(--accent-color);
      color: white;
      grid-column: span 2;
    }

    .equals:hover {
      opacity: 0.9;
    }

    .scientific {
      background-color: var(--secondary-color);
      color: white;
    }

    .scientific:hover {
      opacity: 0.9;
    }

    .graph-btn {
      background-color: #8a4caf;
      color: white;
    }

    .graph-btn:hover {
      background-color: #6b3c86;
    }

    .history {
      padding: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .history h3 {
      margin-bottom: 1rem;
      color: var(--primary-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #historyList {
      list-style-type: none;
      max-height: 200px;
      overflow-y: auto;
    }

    #historyList li {
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border-color);
      word-break: break-all;
    }

    .theme-toggle {
      width: 100%;
      padding: 1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .theme-toggle:hover {
      background-color: var(--secondary-color);
    }

    .graph-container {
      width: 100%;
      max-width: 500px;
      background-color: var(--button-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 2rem;
      padding: 1rem;
      display: none;
    }

    .graph-container.active {
      display: block;
    }

    #graphCanvas {
      width: 100%;
      height: 300px;
      background-color: var(--graph-bg);
      border-radius: 8px;
    }

    .graph-controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .graph-controls input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--display-bg);
      color: var(--text-color);
    }

    .graph-controls button {
      padding: 0.5rem 1rem;
    }

    .clear-history {
      background: none;
      border: none;
      color: var(--accent-color);
      cursor: pointer;
      font-size: 0.9rem;
      text-decoration: underline;
    }

    /* Ad container styles */
    .ad-container {
      background-color: var(--ad-container-bg);
      border: 1px solid var(--ad-border);
      border-radius: 8px;
      padding: 10px;
      margin: 20px 0;
      text-align: center;
      width: 100%;
      max-width: 500px;
    }

    .ad-label {
      font-size: 0.75rem;
      color: #888;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .ad-container ins {
      margin: 0 auto;
      display: block;
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      margin-top: auto;
    }

    @media (max-width: 600px) {
      .calculator-container {
        border-radius: 0;
      }
      
      button {
        padding: 0.8rem;
        font-size: 1rem;
        min-height: 50px;
      }
      
      #display {
        font-size: 1.5rem;
        padding: 1rem;
        min-height: 60px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .header-description {
        font-size: 0.9rem;
      }
      
      .graph-controls {
        flex-direction: column;
      }
      
      .ad-container {
        margin: 15px 0;
        padding: 8px;
      }
    }

    /* Animation for calculation results */
    @keyframes calculate {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .calculating {
      animation: calculate 0.3s ease;
    }
  </style>
</head>
<body>
  <header>
    <h1>Advanced Scientific Calculator</h1>
    <p class="header-description">Free online scientific calculator with graph visualization, advanced functions, and dark/light mode</p>
  </header>
  
  <main>
    <!-- Top Ad -->
    <div class="ad-container">
      <div class="ad-label">Advertisement</div>
      <ins class="adsbygoogle"
           style="display:block; text-align:center;"
           data-ad-layout="in-article"
           data-ad-format="fluid"
           data-ad-client="ca-pub-2488763930939291"
           data-ad-slot="3829694054"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    
    <div class="calculator-container">
      <input type="text" id="display" disabled placeholder="0" aria-label="Calculator display">
      <div class="buttons">
        <button onclick="clearDisplay()" class="operator" aria-label="All Clear">AC</button>
        <button onclick="clearLast()" class="operator" aria-label="Clear">C</button>
        <button onclick="appendToDisplay('%')" class="operator" aria-label="Percentage">%</button>
        <button onclick="appendToDisplay('/')" class="operator" aria-label="Divide">/</button>
        
        <button onclick="appendToDisplay('7')" aria-label="Seven">7</button>
        <button onclick="appendToDisplay('8')" aria-label="Eight">8</button>
        <button onclick="appendToDisplay('9')" aria-label="Nine">9</button>
        <button onclick="appendToDisplay('*')" class="operator" aria-label="Multiply">Ã—</button>
        
        <button onclick="appendToDisplay('4')" aria-label="Four">4</button>
        <button onclick="appendToDisplay('5')" aria-label="Five">5</button>
        <button onclick="appendToDisplay('6')" aria-label="Six">6</button>
        <button onclick="appendToDisplay('-')" class="operator" aria-label="Subtract">-</button>
        
        <button onclick="appendToDisplay('1')" aria-label="One">1</button>
        <button onclick="appendToDisplay('2')" aria-label="Two">2</button>
        <button onclick="appendToDisplay('3')" aria-label="Three">3</button>
        <button onclick="appendToDisplay('+')" class="operator" aria-label="Add">+</button>
        
        <button onclick="appendToDisplay('0')" aria-label="Zero">0</button>
        <button onclick="appendToDisplay('.')" aria-label="Decimal Point">.</button>
        <button onclick="calculateResult()" class="equals" aria-label="Equals">=</button>
        
        <button onclick="calculatePower()" class="scientific" aria-label="Power">x^y</button>
        <button onclick="calculateSquareRoot()" class="scientific" aria-label="Square Root">âˆš</button>
        <button onclick="calculateSin()" class="scientific" aria-label="Sine">sin</button>
        <button onclick="calculateCos()" class="scientific" aria-label="Cosine">cos</button>
        
        <button onclick="calculateTan()" class="scientific" aria-label="Tangent">tan</button>
        <button onclick="calculateLog()" class="scientific" aria-label="Logarithm">log</button>
        <button onclick="calculateLn()" class="scientific" aria-label="Natural Logarithm">ln</button>
        <button onclick="appendToDisplay('(')" class="scientific" aria-label="Left Parenthesis">(</button>
        
        <button onclick="appendToDisplay(')')" class="scientific" aria-label="Right Parenthesis">)</button>
        <button onclick="calculateFactorial()" class="scientific" aria-label="Factorial">x!</button>
        <button onclick="calculatePi()" class="scientific" aria-label="Pi">Ï€</button>
        <button onclick="calculateE()" class="scientific" aria-label="Euler's Number">e</button>
        
        <button onclick="toggleGraph()" class="graph-btn" aria-label="Toggle Graph">Graph</button>
      </div>
      <div class="history">
        <h3>Calculation History <button class="clear-history" onclick="clearHistory()">Clear</button></h3>
        <ul id="historyList"></ul>
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark/Light Mode">Toggle Dark/Light Mode</button>
    </div>
    
    <!-- Middle Ad -->
    <div class="ad-container">
      <div class="ad-label">Advertisement</div>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-format="autorelaxed"
           data-ad-client="ca-pub-2488763930939291"
           data-ad-slot="5005728673"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    
    <div class="graph-container" id="graphContainer">
      <canvas id="graphCanvas"></canvas>
      <div class="graph-controls">
        <input type="text" id="graphFunction" placeholder="Enter function (e.g., x^2)" value="x^2">
        <input type="number" id="graphMin" placeholder="Min X" value="-5" step="0.5">
        <input type="number" id="graphMax" placeholder="Max X" value="5" step="0.5">
        <button onclick="plotGraph()" class="scientific">Plot</button>
      </div>
    </div>
    
    <!-- Bottom Ad -->
    <div class="ad-container">
      <div class="ad-label">Advertisement</div>
      <ins class="adsbygoogle"
           style="display:block; text-align:center;"
           data-ad-layout="in-article"
           data-ad-format="fluid"
           data-ad-client="ca-pub-2488763930939291"
           data-ad-slot="3829694054"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </main>
  
  <footer>
    <p>&copy; 2025 MobileDoctor. All rights reserved. | Advanced Scientific Calculator v2.1</p>
  </footer>

  <script>
    // DOM Elements
    const display = document.getElementById('display');
    const historyList = document.getElementById('historyList');
    const graphContainer = document.getElementById('graphContainer');
    const graphCanvas = document.getElementById('graphCanvas');
    const graphFunction = document.getElementById('graphFunction');
    const graphMin = document.getElementById('graphMin');
    const graphMax = document.getElementById('graphMax');
    
    // Calculator state
    let currentExpression = '';
    let lastResult = '';
    let bracketCount = 0;
    let ctx = graphCanvas.getContext('2d');
    
    // Initialize calculator
    function initCalculator() {
      initTheme();
      loadHistory();
      clearDisplay();
      setupCanvas();
      
      // Add keyboard support
      document.addEventListener('keydown', handleKeyPress);
    }
    
    // Set up canvas for proper rendering
    function setupCanvas() {
      const dpr = window.devicePixelRatio || 1;
      const rect = graphCanvas.getBoundingClientRect();
      
      graphCanvas.width = rect.width * dpr;
      graphCanvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);
      graphCanvas.style.width = `${rect.width}px`;
      graphCanvas.style.height = `${rect.height}px`;
    }

    // Handle keyboard input
    function handleKeyPress(event) {
      const key = event.key;
      
      if (/[0-9]/.test(key)) {
        appendToDisplay(key);
      } else if (key === '+' || key === '-' || key === '*' || key === '/') {
        appendToDisplay(key);
      } else if (key === '.') {
        appendToDisplay('.');
      } else if (key === 'Enter' || key === '=') {
        event.preventDefault();
        calculateResult();
      } else if (key === 'Escape') {
        clearDisplay();
      } else if (key === 'Backspace') {
        clearLast();
      } else if (key === '(' || key === ')') {
        appendToDisplay(key);
      } else if (key === '%') {
        appendToDisplay('%');
      } else if (key === '^') {
        calculatePower();
      }
    }

    // Append a character to the display with auto-bracket completion
    function appendToDisplay(value) {
      if (display.value === '0' && value !== '.' && !isFunctionButton(value)) {
        display.value = value;
      } else {
        // Prevent multiple decimal points in a number
        if (value === '.' && display.value.split(/[\+\-\*\/]/).pop().includes('.')) {
          return;
        }
        
        // Handle auto bracket completion for functions
        if (isFunctionButton(value)) {
          value = value + '(';
          bracketCount++;
        }
        
        // Handle parentheses
        if (value === '(') {
          bracketCount++;
        } else if (value === ')') {
          if (bracketCount > 0) bracketCount--;
        }
        
        display.value += value;
      }
      currentExpression = display.value;
    }
    
    // Check if value represents a function button
    function isFunctionButton(value) {
      return ['sin', 'cos', 'tan', 'log', 'ln', 'âˆš'].includes(value);
    }

    // Clear the display
    function clearDisplay() {
      display.value = '0';
      currentExpression = '';
      bracketCount = 0;
    }

    // Clear the last character from the display
    function clearLast() {
      if (display.value.length > 1) {
        const lastChar = display.value.slice(-1);
        
        // Update bracket count if deleting an opening parenthesis
        if (lastChar === '(') {
          bracketCount--;
        }
        // Update bracket count if deleting a closing parenthesis
        else if (lastChar === ')') {
          bracketCount++;
        }
        
        // Check if we're deleting a function
        const lastThree = display.value.slice(-3);
        if (['sin', 'cos', 'tan', 'log'].includes(lastThree)) {
          display.value = display.value.slice(0, -3);
        } else if (display.value.slice(-2) === 'ln') {
          display.value = display.value.slice(0, -2);
        } else if (display.value.slice(-1) === 'âˆš') {
          display.value = display.value.slice(0, -1);
        } else {
          display.value = display.value.slice(0, -1);
        }
        
        currentExpression = display.value;
      } else {
        display.value = '0';
        currentExpression = '';
        bracketCount = 0;
      }
    }

    // Safe calculation function to replace eval
    function calculate(expression) {
      try {
        // Auto-close any open brackets
        while (bracketCount > 0) {
          expression += ')';
          bracketCount--;
        }
        
        // Validate expression first
        if (!isValidExpression(expression)) {
          throw new Error('Invalid expression');
        }
        
        // Replace functions and constants with JavaScript equivalents
        expression = expression.replace(/sin\(/g, 'Math.sin(');
        expression = expression.replace(/cos\(/g, 'Math.cos(');
        expression = expression.replace(/tan\(/g, 'Math.tan(');
        expression = expression.replace(/log\(/g, 'Math.log10(');
        expression = expression.replace(/ln\(/g, 'Math.log(');
        expression = expression.replace(/Ï€/g, 'Math.PI');
        expression = expression.replace(/e/g, 'Math.E');
        expression = expression.replace(/\^/g, '**');
        expression = expression.replace(/âˆš\(/g, 'Math.sqrt(');
        expression = expression.replace(/%/g, '/100');
        
        // Use Function constructor instead of eval for better security
        return new Function('return ' + expression)();
      } catch (e) {
        throw new Error('Invalid expression');
      }
    }

    // Validate expression for security
    function isValidExpression(expr) {
      // Remove allowed functions and constants
      const cleanedExpr = expr.replace(/sin|cos|tan|log|ln|Ï€|e|âˆš|\d|\+|\-|\*|\/|\(|\)|\.|\^|%/g, '');
      
      // If anything remains, it's not valid
      return cleanedExpr.length === 0;
    }

    // Calculate the result
    function calculateResult() {
      try {
        if (!currentExpression) return;
        
        // Add animation to display
        display.classList.add('calculating');
        
        let result = calculate(currentExpression);
        lastResult = result;
        
        // Format number to avoid too long decimals
        if (typeof result === 'number') {
          result = roundResult(result);
        }
        
        // Add the calculation to history
        addToHistory(`${currentExpression} = ${result}`);
        
        display.value = result;
        currentExpression = result.toString();
        
        // Save history to localStorage
        saveHistory();
        
        // Remove animation after calculation
        setTimeout(() => {
          display.classList.remove('calculating');
        }, 300);
      } catch (e) {
        display.value = 'Error';
        setTimeout(() => {
          display.value = currentExpression || '0';
        }, 1500);
      }
    }

    // Round result to avoid floating point issues
    function roundResult(num) {
      // Round to 10 decimal places to avoid floating point precision issues
      return Math.round(num * 10000000000) / 10000000000;
    }

    // Scientific functions
    function calculateSin() {
      appendToDisplay('sin(');
    }

    function calculateCos() {
      appendToDisplay('cos(');
    }

    function calculateTan() {
      appendToDisplay('tan(');
    }

    function calculateLog() {
      appendToDisplay('log(');
    }

    function calculateLn() {
      appendToDisplay('ln(');
    }

    function calculateSquareRoot() {
      appendToDisplay('âˆš(');
    }

    function calculatePower() {
      if (display.value === '0') {
        display.value = '';
      }
      appendToDisplay('^');
    }

    function calculateFactorial() {
      try {
        let num = parseFloat(display.value);
        if (isNaN(num) || num < 0 || !Number.isInteger(num)) {
          throw new Error('Invalid input for factorial');
        }
        
        let result = 1;
        for (let i = 2; i <= num; i++) {
          result *= i;
        }
        
        addToHistory(`${num}! = ${result}`);
        display.value = result;
        currentExpression = result.toString();
        saveHistory();
      } catch (e) {
        display.value = 'Error';
        setTimeout(() => {
          display.value = currentExpression || '0';
        }, 1500);
      }
    }

    function calculatePi() {
      if (display.value === '0') {
        display.value = 'Ï€';
      } else {
        appendToDisplay('Ï€');
      }
    }

    function calculateE() {
      if (display.value === '0') {
        display.value = 'e';
      } else {
        appendToDisplay('e');
      }
    }
    
    // Toggle graph visibility
    function toggleGraph() {
      graphContainer.classList.toggle('active');
      if (graphContainer.classList.contains('active')) {
        plotGraph();
      }
    }
    
    // Plot graph based on function input
    function plotGraph() {
      const funcStr = graphFunction.value || 'x^2';
      const minX = parseFloat(graphMin.value) || -5;
      const maxX = parseFloat(graphMax.value) || 5;
      
      // Clear canvas
      ctx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
      
      // Draw axes
      drawAxes(minX, maxX);
      
      // Plot function
      plotFunction(funcStr, minX, maxX);
    }
    
    // Draw coordinate axes
    function drawAxes(minX, maxX) {
      const width = graphCanvas.width / (window.devicePixelRatio || 1);
      const height = graphCanvas.height / (window.devicePixelRatio || 1);
      const x0 = width / 2;
      const y0 = height / 2;
      const scale = width / (maxX - minX);
      
      // Get CSS variable values properly
      const graphAxisColor = getComputedStyle(document.documentElement).getPropertyValue('--graph-axis').trim();
      const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
      
      ctx.strokeStyle = graphAxisColor;
      ctx.lineWidth = 1;
      
      // X-axis
      ctx.beginPath();
      ctx.moveTo(0, y0);
      ctx.lineTo(width, y0);
      ctx.stroke();
      
      // Y-axis
      ctx.beginPath();
      ctx.moveTo(x0, 0);
      ctx.lineTo(x0, height);
      ctx.stroke();
      
      // Draw ticks on X-axis
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillStyle = textColor;
      ctx.font = '10px Arial';
      
      for (let x = Math.ceil(minX); x <= maxX; x++) {
        if (x === 0) continue; // Skip 0 to avoid overlapping with Y-axis
        
        const xPos = x0 + x * scale;
        ctx.beginPath();
        ctx.moveTo(xPos, y0 - 5);
        ctx.lineTo(xPos, y0 + 5);
        ctx.stroke();
        
        ctx.fillText(x.toString(), xPos, y0 + 8);
      }
      
      // Draw ticks on Y-axis
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      
      const yStep = height / (maxX - minX);
      for (let y = Math.ceil(minX); y <= maxX; y++) {
        if (y === 0) continue; // Skip 0 to avoid overlapping with X-axis
        
        const yPos = y0 - y * scale;
        ctx.beginPath();
        ctx.moveTo(x0 - 5, yPos);
        ctx.lineTo(x0 + 5, yPos);
        ctx.stroke();
        
        ctx.fillText(y.toString(), x0 - 8, yPos);
      }
      
      // Draw origin point (0,0)
      ctx.textAlign = 'right';
      ctx.textBaseline = 'top';
      ctx.fillText('0', x0 - 8, y0 + 8);
    }
    
    // Plot a mathematical function
    function plotFunction(funcStr, minX, maxX) {
      const width = graphCanvas.width / (window.devicePixelRatio || 1);
      const height = graphCanvas.height / (window.devicePixelRatio || 1);
      const x0 = width / 2;
      const y0 = height / 2;
      const scale = width / (maxX - minX);
      
      // Get CSS variable values properly
      const graphLineColor = getComputedStyle(document.documentElement).getPropertyValue('--graph-line').trim();
      
      ctx.strokeStyle = graphLineColor;
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      let isFirstPoint = true;
      
      for (let i = 0; i <= width; i++) {
        const x = minX + i * (maxX - minX) / width;
        
        try {
          // Replace x in the function string with the current x value
          let expression = funcStr.replace(/x/g, `(${x})`);
          
          // Handle special functions and constants
          expression = expression.replace(/sin\(/g, 'Math.sin(');
          expression = expression.replace(/cos\(/g, 'Math.cos(');
          expression = expression.replace(/tan\(/g, 'Math.tan(');
          expression = expression.replace(/log\(/g, 'Math.log10(');
          expression = expression.replace(/ln\(/g, 'Math.log(');
          expression = expression.replace(/Ï€/g, 'Math.PI');
          expression = expression.replace(/e/g, 'Math.E');
          expression = expression.replace(/\^/g, '**');
          expression = expression.replace(/âˆš\(/g, 'Math.sqrt(');
          
          // Evaluate the expression
          const y = new Function('return ' + expression)();
          
          // Check if y is a valid number
          if (isNaN(y) || !isFinite(y)) {
            isFirstPoint = true;
            continue;
          }
          
          const xPos = i;
          const yPos = y0 - y * scale;
          
          if (isFirstPoint) {
            ctx.moveTo(xPos, yPos);
            isFirstPoint = false;
          } else {
            ctx.lineTo(xPos, yPos);
          }
        } catch (e) {
          isFirstPoint = true;
        }
      }
      
      ctx.stroke();
    }

    // Add calculation to history
    function addToHistory(calculation) {
      let historyItem = document.createElement('li');
      historyItem.textContent = calculation;
      historyList.appendChild(historyItem);
      
      // Keep only the last 10 history items
      if (historyList.children.length > 10) {
        historyList.removeChild(historyList.firstChild);
      }
    }

    // Clear history
    function clearHistory() {
      historyList.innerHTML = '';
      localStorage.removeItem('calculatorHistory');
    }

    // Save history to localStorage
    function saveHistory() {
      const historyItems = [];
      for (let i = 0; i < historyList.children.length; i++) {
        historyItems.push(historyList.children[i].textContent);
      }
      localStorage.setItem('calculatorHistory', JSON.stringify(historyItems));
    }

    // Load history from localStorage
    function loadHistory() {
      const savedHistory = localStorage.getItem('calculatorHistory');
      if (savedHistory) {
        const historyItems = JSON.parse(savedHistory);
        historyItems.forEach(item => {
          addToHistory(item);
        });
      }
    }

    // Toggle between light and dark modes
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      
      // Save theme preference to localStorage
      const isDarkMode = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);
      
      // Redraw graph if visible
      if (graphContainer.classList.contains('active')) {
        plotGraph();
      }
    }

    // Initialize theme from localStorage
    function initTheme() {
      const darkMode = localStorage.getItem('darkMode') === 'true';
      if (darkMode) {
        document.body.classList.add('dark-mode');
      }
    }

    // Initialize when page loads
    window.onload = initCalculator;
    window.addEventListener('resize', function() {
      if (graphContainer.classList.contains('active')) {
        setupCanvas();
        plotGraph();
      }
    });
  </script>
</body>
</html>
